// Generated by CoffeeScript 1.6.3
(function() {
  var flySwatter, renderWidget,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  flySwatter = (function() {
    function flySwatter(options) {
      this.submit_bug_report = __bind(this.submit_bug_report, this);
      this.options = options;
      this.id = "fly-swatter-widget-wrapper";
      this.render();
      this._init_binders();
    }

    flySwatter.prototype.render = function() {
      var html;
      html = "<div id=\"" + this.id + "\">\n  <div class=\"click-tab\">\n    <div class=\"bug-icon\"><i class=\"icon-bug\"></i></div>\n  </div>\n\n  <div class=\"form-wrapper\">\n    <form>\n      Bug: <textarea type=\"input\" name=\"bug\"></textarea>\n    </form>\n\n    <div class=\"fs-button-wrapper\">\n      <div class=\"fs-submit-button\">Submit Bug</div>\n    </div>\n  </div>\n</div>";
      return $('body').append(html);
    };

    flySwatter.prototype.submit_bug_report = function() {
      var input_data;
      input_data = this._parse_form();
      return $.ajax({
        url: 'http://localhost:3001/bug_reports',
        data: input_data,
        dataType: 'json',
        type: 'POST',
        complete: this.thank_you()
      });
    };

    flySwatter.prototype.thank_you = function() {
      var $elm;
      $elm = $("#" + this.id);
      $elm.find('.form-wrapper').html('<h1>Thank you</h1>');
      return $elm.find('.click-tab').click();
    };

    flySwatter.prototype._init_binders = function() {
      var $elm;
      $elm = $("#" + this.id);
      $elm.on('click', '.click-tab', function() {
        var change;
        change = $(this).hasClass('hidden') ? '+=335px' : '-=335px';
        $elm.animate({
          left: change
        });
        return $(this).toggleClass('hidden');
      });
      return $elm.on('click', '.fs-submit-button', this.submit_bug_report);
    };

    flySwatter.prototype._parse_form = function() {
      var $form, data;
      $form = $("#" + this.id).find('form');
      data = {};
      data.description = $form.find('textarea[name="bug"]').val();
      data.page_url = window.location.href;
      data.browser_info = this._browser_info();
      data.unique_key = _fly_swatter_id;
      return data;
    };

    flySwatter.prototype._browser_info = function() {
      var M, N, tem, ua;
      ua = navigator.userAgent;
      N = navigator.appName;
      M = ua.match(/(opera|chrome|safari|firefox|msie|trident)\/?\s*([\d\.]+)/i) || [];
      M = M[2] ? [M[1], M[2]] : [N, navigator.appVersion, '-?'];
      if (M && (tem = ua.match(/version\/([\.\d]+)/i)) !== null) {
        M[2] = tem[1];
      }
      return M.join(' ');
    };

    return flySwatter;

  })();

  $.ajax({
    url: 'http://localhost:3001/users/' + _fly_swatter_id + '/widget.json',
    type: 'GET',
    success: function(json) {
      return renderWidget(json);
    }
  });

  renderWidget = function(json) {
    var f;
    console.log(json);
    return f = new flySwatter;
  };

}).call(this);
